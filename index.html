<!DOCTYPE html>
<html>
	<head>
		<title>Parky Mobile</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
 
		<!-- Styles -->
		<link rel="stylesheet" href="kendo/styles/kendo.mobile.all.min.css" />
		<link rel="stylesheet" href="kendo/styles/kendo.parky.mobile.all.css" />
 
		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script type="text/javascript" src="kendo/js/jquery.min.js"></script>
		<script type="text/javascript" src="kendo/js/kendo.mobile.min.js"></script>
        
       <link rel="stylesheet" href="css/main_page_list.css" />
        

        <!-- MOBISCROLL -->

       <link rel="stylesheet" type="text/css" href="css/mobiscroll_text_and_image.css"  />
   	 <script type="text/javascript" src="js/mobiscroll-2.4.custom.min.js" ></script> 
   	 <script type="text/javascript" charset="utf-8" src="Plugins/Barcode Scanner/barcodescanner.js"></script>

        <!-- app globals -->
        <script type="text/javascript" src="scripts/serverApi.js"></script>
        <script type="text/javascript" src="scripts/app.js"></script>
        <script type="text/javascript" src="scripts/camera_and_geolocation.js"></script> 
        
		<!-- Default Stylesheet -->
		<link rel="stylesheet" href="styles/main.css" />

		<!-- Phone 320x480 High DPI (aka Retina) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 320px) and (max-device-width: 480px) and (-webkit-device-pixel-ratio:2)" href="styles/phone-480.css" type="text/css" />
		<!-- Phone 480x800 Medium DPI (aka Samsung Galaxy S II Skyrocket) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 320px) and (max-device-width: 508px) and (-webkit-device-pixel-ratio:1.5)" href="styles/phone-800.css" type="text/css" />
		<!-- Tablet 768x1024 Low DPI (aka iPad 1 & 2") -->
		<link rel="stylesheet" media="only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-device-pixel-ratio:1)" href="styles/tablet-1024-ldpi.css" type="text/css" />
		<!-- Tablet 800x1280 Low DPI (aka Samsung Galaxy Tab 8.9" & Lenovo K1) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 800px) and (max-device-width: 1280px) and (-webkit-device-pixel-ratio:1)" href="styles/tablet-1280.css" type="text/css" />
		<!-- Phone 720x1280 High DPI (aka Google Nexus) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 720px) and (max-device-width: 1280px) and (-webkit-device-pixel-ratio:2)" href="styles/phone-1280.css" type="text/css" />
		<!-- Tablet 500x1024 Low DPI (aka Kindle Fire) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 600px) and (max-device-width: 1024px) and (-webkit-device-pixel-ratio:1)" href="styles/tablet-600-1024.css" type="text/css" />
		<!-- Tablet 768x1024 High DPI (aka iPad3") -->
		<link rel="stylesheet" media="only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-device-pixel-ratio:2)" href="styles/tablet-1024-hdpi.css" type="text/css" />
		

	</head>
    
    
	<body>
        
        <!-- ========== LOGIN/STARTUP PAGE ============= -->

        <div data-role="view" id="login" data-title="Parky">
            
            <ul data-role="listview" id="signupView" data-style="inset" data-inset="true">
            	<li>
            		<a  href="#view-signup" id="sign_up" data-rel="view">Sign Up</a>
            	</li>                        
            </ul>
            
            <ul data-role="listview" id="signinView" data-style="inset" data-inset="true">
            	<li>
            		<a  href="#view-signin" id="sign_in" data-rel="view">Sign In</a>
            	</li>                        
            </ul>            
        </div>               
                
         
        <div data-role="view" id="view-signup"  data-show="afterShowSignup">
            
            <div data-role="header">
                <div data-role="navbar">
                    <span>Sign-Up</span>
                </div>
            </div>
            
            <ul data-role="listview" data-style="inset">
                <li><label for="firstname">Firstname:</label> <input type="text" id="firstname" /></li>
                <li><label for="lastname">Lastname:</label> <input type="text" id="lastname" /></li>
                <li><label for="phone">Phone:</label> <input type="tel" id="phone" /></li>
                <li><label for="credit_card_number">Credit Card:</label> <input type="text" id="credit_card_number" /></li>
                <li><label for="email-signup">Email:</label> <input type="email" id="email-signup" /></li>
                <li><label for="password-signup">Password:</label> <input type="password" id="password-signup" /></li>
            </ul>
            
            <div data-role="footer">
                <div data-role="navbar">
                    <span></span>
                    <a data-click="closeViewSignUp" data-role="button" data-align="right">Sign Up</a>
                    <a href="#login" data-role="button" data-align="left">Cancel</a>
                </div>
            </div>
        
        </div>
        
         <!-- ========== SIGNIN STUFF ============= -->
        
        <div data-role="view" id="view-signin" data-show="afterShowSignin">
            <div data-role="header">
                <div data-role="navbar">
                    <span>Sign In</span>
                 </div>
            </div>
        
            <ul data-role="listview" data-style="inset">
                <li><label for="email-signin">Email:</label> <input type="email" id="email-signin" /></li>
                <li><label for="password-signin">Password:</label> <input type="password" id="password-signin" /></li>
            </ul>
            <div data-role="footer">
                <div data-role="navbar">
                    <span></span>
                    <a data-click="closeViewSignIn" data-role="button" data-align="right">Sign In</a>
                    <a href="#login" data-role="button" data-align="left">Cancel</a>
                </div>
            </div>
        </div>     
        
        <!-- ========== SETTINGS VIEW ============= -->
          
        <div data-role="view" id="settingsView" data-style="inset" data-title="Settings" data-init="settingsViewInit" >
        	<div id="settingsViewContent" data-role="content">
                <ul data-role="listview" id="signoutView" data-style="inset" data-inset="true" data-click="closeViewSignOut">
        			<li>
        				<a id="sign_out" data-rel="modalview">Sign Out</a>
        			</li>                        
        		</ul>
                <ul data-role="listview" id="updateView" data-style="inset" data-inset="true" >
        			<li>
        				<a href="#accountSettingsView" data-rel="view">Account</a>
        			</li>
        		</ul>
        		<ul data-role="listview" id="scanView" data-style="inset" data-inset="true"  >
        			<li>
        				<a href="#modalview-scan" data-rel="modalview">Scan</a>
        			</li>                        
        		</ul>
                 <ul data-role="listview" id="remindersView" data-style="inset" data-inset="true" >
        			<li>
        				<a href="#settings" data-rel="modalview">Reminders</a>
        			</li>
        		</ul>
                <ul data-role="listview" id="prepaidView" data-style="inset" data-inset="true" >
        			<li>
        				<a href="#settings" data-rel="modalview">Pre-paid</a>
        			</li>
        		</ul>
            </div>
        </div>
            
        <!-- ========== SETTINGS|ACCOUNT VIEW ============= -->
        
        <div data-role="view" id="accountSettingsView" data-style="inset" >
            
            <div data-role="header">
                <div data-role="navbar">
                    <span>accountSettingsView</span>
                 </div>
            </div>
            
            <ul data-role="listview" id="signoutView" data-style="inset" data-inset="true" data-click="updateAccountDetails">
        			<li>
        				<a id="#view-update-account" data-rel="view">Update account</a>
        			</li>                        
        		</ul>
                <ul data-role="listview" id="addACarView" data-style="inset" data-inset="true" >
        			<li>
        				<a href="#modalview-addCar" data-rel="modalview">Add a car</a>
        			</li>
        		</ul>
        		<ul data-role="listview" id="delACarView" data-style="inset" data-inset="false"   data-click="chooseCarToDelete">
        			<li>
        				<a>Delete a car</a>
        			</li>
        		</ul>
            
            <div data-role="footer">
                <div data-role="navbar">
                    <span></span>
                    <!-- <a data-click="#settingsView" data-role="button" data-align="left">Cancel</a> -->
                    <a href="#settingsView" data-role="button" data-align="right">Done</a>
               </div>
            </div>
           
        </div>
               
        <!-- ========== SETTINGS|ACCOUNT|ACCOUNT UPDATE STUFF ============= -->
        
        <div data-role="view" id="view-update-account"  data-show="prefillAccountDetails">
            
            <div data-role="header">
                <div data-role="navbar">
                    <span>Update Account</span>
                </div>
            </div>
           
            <ul data-role="listview" data-style="inset">
                <li><label for="firstname">Firstname:</label> <input type="text" id="update_firstname" /></li>
                <li><label for="lastname">Lastname:</label> <input type="text" id="update_lastname" /></li>
                <li><label for="phone">Phone:</label> <input type="tel" id="update_phone" /></li>
                <li><label for="credit_card_number">Credit Card:</label> <input type="text" id="update_credit_card_number" /></li>
                <li><label for="email-signup">Email:</label> <input type="email" id="update_email-signin" /></li>
                <li><label for="password-signup">Password:</label> <input type="password" id="update_password-signin" /></li>
            </ul>
            
            <div data-role="footer">
                <div data-role="navbar">
                    <span></span>
                    <a data-click="closeViewUpdateAccount" data-role="button" data-align="right">Update</a>
                    <a href="#accountSettingsView" data-role="button" data-align="left">Cancel</a>
                </div>
            </div>
           
        </div>
         

        <!-- ========== ADD A CAR STUFF ============= -->
        
        <div data-role="modalview" id="modalview-addCar" style="width: 95%; height: 70%;">
            
            <div data-role="header">
                <div data-role="navbar">
                    <span>Add Car</span>
                 </div>
            </div>
           
        	<div id='helloWorldInput'>		
        		<input type="text" id="txtName" value="Car Number" style="display:block;margin: 8% auto 0px auto;width:80%;"/>
        	</div>
        
            <div>
                <img style="display:block;margin: 10% auto 5% auto; width:50%; height:40%;" id="smallImage" src="images/car.png" />
            </div>
            <div data-role="footer">
                <div data-role="navbar">
                    <span></span>
                    <a data-click="closeModalAddCarCancel" data-role="button" data-align="left">Cancel</a>
                    <a data-click="closeModalAddCar" data-role="button" data-align="right">Done</a>
               </div>
            </div>
            
             
        </div>
        
     
        
        <!-- ============================== -->
        <!--  Cars list  scroller template  -->
        <!-- ============================== -->
        <!-- DEBUG -->
        <div id="CarsListScrollerTemplateResults"  style="display: none;"></div>
        <!-- /DEBUG -->
        <script id="CarsListScrollerTemplate" type="text/x-kendo-template">
                <div class="icc">
                    <div class="ic">
                        <ul id="CarsListScroller">
                         # for (var i = 0; i < data.length; i++) 
                            { #
                            <li data-val="#= data[i].ID #">
                               <div class="car">
                                  <div class="img-cont">
                                      <img src="#= data[i].PictureUrl #" />                                      
                                  </div>
                                  <span>#= data[i].registration #</span>
                              </div>
                            </li>
                          # } #
                        </ul>
                    </div>
                </div>
        </script> 

        <!-- ============================== -->
        <!--  regions list  scroller template  -->
        <!-- ============================== -->
        <!-- DEBUG -->
        <div id="RegionsListScrollerTemplateResults"  style="display: none;"></div>
        <!-- /DEBUG -->
        <script id="RegionsListScrollerTemplate" type="text/x-kendo-template">
                <div class="icc">
                    <div class="ic">
                        <ul id="RegionsListScroller">
                         # for (var i = 0; i < data.length; i++) 
                            { #
                            <li data-val="#= data[i].ID #">
                                  #= data[i].City #
                                  <ul>
                                     # for (var j = 0; j < data[i].Suburb.length; j++) 
                                        { #
                                        <li data-val="#= data[i].Suburb[j].ID #">
                                           #= data[i].Suburb[j].sub #
                                        </li>
                                      # } #       
                                  </ul> 
                            </li>
                          # } #
                        </ul>
                    </div>
                </div>
        </script> 
        
        <script>
            
  	      var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "jitterz-default" });
            
  				function onLoad() 
  				{ 
  					document.addEventListener("deviceready", onDeviceReady, false); 
  				}           
            
            var ParkingActive;

            // TODO: remove when in production - this is good for debugging since web browser typically clear the storage on app restart
            //window.localStorage.setItem("last_email_signin","alior101@gmail.com" );
            //window.localStorage.setItem("last_password_signin", "kellogskellogs");
            
            function afterShowSignin(e) 
            {
               
                //window.localStorage.setItem("last_email_signin","alior101@gmail.com" );
                //window.localStorage.setItem("last_password_signin", "kellogskellogs");
            
                console.log(e.view);
                
                //var auth_token = window.localStorage.getItem("auth_token");
                console.log("auth_token = "+ _serverApi.auth_token);
                if (_serverApi.auth_token != null )
                {
                    console.log("(auth_token != null )");
                    app.navigate("views/homeView.html"); 
                }
                else if (user_data!=null)
                {
                     document.getElementById("email-signin").value = user_data['user']['email']; // window.localStorage.getItem("last_email_signin");
                    document.getElementById("password-signin").value = user_data['user']['password']; //window.localStorage.getItem("last_password_signin");
                    
                }
            }
            
            function afterShowSignup(e) {
            }
            
  	      //var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "" });
            
            /*
            function redirectBack(e) 
            {
                e.preventDefault();
                 //console.log(e.view);    
                $("#modalview-addCar").kendoMobileModalView("close");
                $("#modalview-login").kendoMobileModalView("close");
                $("#modalview-signin").kendoMobileModalView("close");
                
            }
            */      			

        
            function closeViewSignUp() 
            {
                var firstname = $("#firstname").val();
                var lastname = $("#lastname").val();
                var phone = $("#phone").val();
                var credit_card_number = $("#credit_card_number").val();
                var id_card_number = $("#id_card_number").val();
                var email = $("#email-signup").val();
                var password = $("#password-signup").val();
                
                app.showLoading();

                //TODO: add phone and credit_card_number to server, add as accessible attr
                user_data = {user: {email: email, password: password, password_confirmation: password, firstname: firstname, lastname: lastname } } //, phone: phone, credit_card_number: credit_card_number, id_card_number: id_card_number
                user_data_str = JSON.stringify(user_data);
                window.localStorage.setItem("user_data",user_data_str);

                _serverApi.sign_up({
                    data: user_data,
                    success: function(response)  {
                        app.hideLoading();
                        $("#modalview-signup").kendoMobileView("close");
                        app.navigate("views/homeView.html");
                    },
                    error: function(errorThrown)  {
                        app.hideLoading();
                        alert('Signup Failed');
                        app.navigate("#login");
                    }
                });
            }
            
            function closeViewSignIn() 
            {
                app.showLoading();
                
                var email = $("#email-signin").val();
                var password = $("#password-signin").val();

                user_data = {user: {email: email, password: password} }
                user_data_str = JSON.stringify(user_data);
                window.localStorage.setItem("user_data",user_data_str);

                _serverApi.sign_in({
                    data: user_data,
                    success: function(response)  {
                        app.hideLoading();
                        app.navigate("views/homeView.html");
                        //app.navigate("#start");
                        console.log('navigate: ' + _serverApi.auth_token);
                    },
                    error: function(errorThrown)  {
                        app.hideLoading();
                        alert('Sign in failed');
                        app.navigate("#login");
                    }
                });
            }
            

            function closeModalAddCar() 
            {
                console.log("closeModalAddCar");
                $("#modalview-addCar").data("kendoMobileModalView").close();
            }
            function closeModalAddCarCancel() 
            {
                console.log("closeModalAddCarCancel");
                $("#modalview-addCar").data("kendoMobileModalView").close();
            }
            
            function chooseCarToDelete() 
            {                 
                console.log("chooseCarToDelete");
        	    $('#CarsListScroller').mobiscroll('show');
                // ofer delete the car 
    			return false;
    		}
            
            function updateAccountDetails()
            {
                app.navigate("#view-update-account");
            }
            
            function prefillAccountDetails()
            {
                
                    console.log("prefill");
                    // OFER - get account details from server or from local storage ?
                    document.getElementById("update_email-signin").value = user_data['user']['email']; // window.localStorage.getItem("last_email_signin");
                    document.getElementById("update_password-signin").value = user_data['user']['password']; // window.localStorage.getItem("last_password_signin");
                    document.getElementById("update_firstname").value = user_data['user']['firstname']; //window.localStorage.getItem("last_lastname");
                    document.getElementById("update_lastname").value = user_data['user']['lastname']; //window.localStorage.getItem("last_lastname");
                    document.getElementById("update_phone").value = user_data['user']['phone']; // window.localStorage.getItem("last_phone");
                    document.getElementById("update_credit_card_number").value = user_data['user']['credit_card_number']; // window.localStorage.getItem("last_credit_card_number");
            }
            
                
            function closeViewSignOut() 
            {
                console.log("closeViewSignOut");
                _serverApi.sign_out();
                app.navigate("#login");
                //app.navigate("../index.html");
            }
                        
        </script>

	</body>
</html>