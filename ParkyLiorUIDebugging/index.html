<!DOCTYPE html>
<html>
	<head>
		<title>Parky Mobile</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
 
		<!-- Styles -->
		<link rel="stylesheet" href="kendo/styles/kendo.mobile.all.min.css" />
		<link rel="stylesheet" href="kendo/styles/kendo.parky.mobile.all.css" />
        
		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script type="text/javascript" src="kendo/js/jquery.min.js"></script>
		<script type="text/javascript" src="kendo/js/kendo.mobile.min.js"></script>
        
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
        <link rel="stylesheet" href="css/main_page_list.css" />
        

        <!-- MOBISCROLL -->
        <link rel="stylesheet" type="text/css" href="css/mobiscroll_text_and_image.css"  />
   	 <script type="text/javascript" src="js/mobiscroll-2.4.custom.min.js" ></script> 
   	 <script type="text/javascript" charset="utf-8" src="Plugins/Barcode Scanner/barcodescanner.js"></script>
        
        <!-- app globals -->
        <script type="text/javascript" src="../scripts/app.js"></script>
        
		<!-- Default Stylesheet -->
		<link rel="stylesheet" href="styles/main.css" />

		<!-- Phone 320x480 High DPI (aka Retina) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 320px) and (max-device-width: 480px) and (-webkit-device-pixel-ratio:2)" href="styles/phone-480.css" type="text/css" />
		<!-- Phone 480x800 Medium DPI (aka Samsung Galaxy S II Skyrocket) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 320px) and (max-device-width: 508px) and (-webkit-device-pixel-ratio:1.5)" href="styles/phone-800.css" type="text/css" />
		<!-- Tablet 768x1024 Low DPI (aka iPad 1 & 2") -->
		<link rel="stylesheet" media="only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-device-pixel-ratio:1)" href="styles/tablet-1024-ldpi.css" type="text/css" />
		<!-- Tablet 800x1280 Low DPI (aka Samsung Galaxy Tab 8.9" & Lenovo K1) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 800px) and (max-device-width: 1280px) and (-webkit-device-pixel-ratio:1)" href="styles/tablet-1280.css" type="text/css" />
		<!-- Phone 720x1280 High DPI (aka Google Nexus) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 720px) and (max-device-width: 1280px) and (-webkit-device-pixel-ratio:2)" href="styles/phone-1280.css" type="text/css" />
		<!-- Tablet 500x1024 Low DPI (aka Kindle Fire) -->
		<link rel="stylesheet" media="only screen and (min-device-width: 600px) and (max-device-width: 1024px) and (-webkit-device-pixel-ratio:1)" href="styles/tablet-600-1024.css" type="text/css" />
		<!-- Tablet 768x1024 High DPI (aka iPad3") -->
		<link rel="stylesheet" media="only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-device-pixel-ratio:2)" href="styles/tablet-1024-hdpi.css" type="text/css" />
        
 
       
	</head>
    
    
	<body>
        
        <div data-role="view" id="login" data-title="Parky">
            
            <ul data-role="listview" id="signupView" data-style="inset" data-inset="true" >
            	<li>
            		<a  href="#view-signup" id="sign_up" data-rel="view">Sign Up</a>
            	</li>                        
            </ul>
            
            <ul data-role="listview" id="signinView" data-style="inset" data-inset="true">
            	<li>
            		<a  href="#view-signin" id="sign_in" data-rel="view">Sign In</a>
            	</li>                        
            </ul>
            
        </div>               
                
         <!-- ========== SIGNUP STUFF ============= -->
        
        <div data-role="view" id="view-signup">
            
            <div data-role="header">
                <div data-role="navbar">
                    <span>Sign-Up</span>
                </div>
            </div>
            
            <ul data-role="listview" data-style="inset">
                <li><label for="firstname">Firstname:</label> <input type="text" id="firstname" /></li>
                <li><label for="lastname">Lastname:</label> <input type="text" id="lastname" /></li>
                <li><label for="phone">Phone:</label> <input type="tel" id="phone" /></li>
                <li><label for="credit_card_number">Credit Card:</label> <input type="text" id="credit_card_number" /></li>
                <li><label for="email-signup">Email:</label> <input type="email" id="email-signup" /></li>
                <li><label for="password-signup">Password:</label> <input type="password" id="password-signup" /></li>
            </ul>
            
            <div data-role="footer">
                <div data-role="navbar">
                    <span></span>
                    <a data-click="closeViewSignUp" data-role="button" data-align="right">Sign Up</a>
                    <a href="#login" data-role="button" data-align="left">Cancel</a>
                </div>
            </div>
        
        </div>
        
         
        <!-- ========== SIGNIN STUFF ============= -->
        
        <div data-role="view" id="view-signin">
            <div data-role="header">
                <div data-role="navbar">
                    <span>Sign In</span>
                 </div>
            </div>
        
            <ul data-role="listview" data-style="inset">
                <li><label for="emailemail-signin">Email:</label> <input type="email" id="email-signin" /></li>
                <li><label for="password-signin">Password:</label> <input type="password" id="password-signin" /></li>
            </ul>
            <div data-role="footer">
                <div data-role="navbar">
                    <span></span>
                    <a data-click="closeViewSignIn" data-role="button" data-align="right">Sign In</a>
                    <a href="#login" data-role="button" data-align="left">Cancel</a>
                </div>
            </div>
        </div>     
        
		
        <script>
            
  	      var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "jitterz-default" });
            var ParkingActive;
            
           
            if (auth_token != null ) 
            {
                app.navigate("views/homeView.html");
            }
            else
            {
                // TODOD change to take from local storage
                document.getElementById("email-signin").value = "alior101@gmail.com";
                document.getElementById("password-signin").value = "kellogskellogs";
                app.navigate("#login");
            }
           
            
  	      //var app = new kendo.mobile.Application(document.body, { transition: "slide", layout: "" });
            
            /*
            function redirectBack(e) 
            {
                e.preventDefault();
                 //console.log(e.view);    
                $("#modalview-addCar").kendoMobileModalView("close");
                $("#modalview-login").kendoMobileModalView("close");
                $("#modalview-signin").kendoMobileModalView("close");
                
            }
            */      			

        
            function closeViewSignUp() 
            {
                var firstname = $("#firstname").val();
                var lastname = $("#lastname").val();
                var phone = $("#phone").val();
                var credit_card_number = $("#credit_card_number").val();
                var id_card_number = $("#id_card_number").val();
                var email = $("#email-signup").val();
                var password = $("#password-signup").val();
                
                app.showLoading();
                
                //TODO: add phone and credit_card_number to server, add as accessible attr
                user_data = {user: {email: email, password: password, password_confirmation: password, firstname: firstname, lastname: lastname } } //, phone: phone, credit_card_number: credit_card_number, id_card_number: id_card_number
                user_data_str = JSON.stringify(user_data);
                window.localStorage.setItem("user_data",user_data_str);
                
                $.ajax({
            		url: "http://inigo.com.au/users.json",
            		dataType: "json",
            		type: "post",
            		cache: false,
            		data: user_data,
            		success: function(response) 
                    {
                        app.hideLoading();
                        auth_token = response.data.auth_token;
                        window.localStorage.setItem("auth_token",auth_token);
                        console.log('auth_token: ' + auth_token);
                        $("#modalview-signup").kendoMobileView("close");
                        app.navigate("views/homeView.html");
            		},
            		error: function(jqXHR, textStatus, errorThrown) 
                    {
                        
                        app.hideLoading();
            			console.log(jqXHR, textStatus, errorThrown);
                        window.localStorage.removeItem("auth_token");
                        alert('Signup Failed');  
                        app.navigate("#login");
            	    }
            	});
            }
            
            function closeViewSignIn() 
            {
                app.showLoading();
                
                var email = $("#email-signin").val();
                var password = $("#password-signin").val();
                
                //Get fresh data
            	$.ajax({
                    url: "http://inigo.com.au/users/sign_in.json",
                    dataType: "json",
                    type: "post",
                    cache: false,
                    data: {user:{email:email, password:password}},
                    success: function(response) 
                    {
                        console.log(response.session);
                        auth_token = response.session.auth_token;
                        window.localStorage.setItem("auth_token",auth_token);
                        app.hideLoading();
                        console.log('auth_token: ' + auth_token);
                        app.navigate("views/homeView.html");
                    },
                    error: function(jqXHR, textStatus, errorThrown) 
                    {
                        console.log(jqXHR, textStatus, errorThrown);
                        window.localStorage.removeItem("auth_token");
                        app.hideLoading();
                        alert('Sign in failed'); 
                        app.navigate("#login");
                    }
                });
            }
            

            
        </script>

	</body>
</html>